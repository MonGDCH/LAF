<?php

/*
|--------------------------------------------------------------------------
| 定义应用根路径
|--------------------------------------------------------------------------
| 这里定义根路径，用户路径查找
|
*/
define('ROOT_PATH', __DIR__ . '/..');

/*
|--------------------------------------------------------------------------
| 加载composer
|--------------------------------------------------------------------------
| 加载composer, 处理类文件自动加载
|
*/
require ROOT_PATH . '/vendor/autoload.php';


/*
|--------------------------------------------------------------------------
| 创建应用实例
|--------------------------------------------------------------------------
| 这里创建应用实例
|
*/
$app = \FApi\App::instance();


/*
|--------------------------------------------------------------------------
| 注册配置信息
|--------------------------------------------------------------------------
| 这里注册加载全局配置信息
|
*/
$app->register( require(ROOT_PATH.'/bootstrap/config.php') );


/*
|--------------------------------------------------------------------------
| 定义应用时区
|--------------------------------------------------------------------------
| 这里设置时区
|
*/
date_default_timezone_set( $app->config->get('time_zone', 'PRC') );


/*
|--------------------------------------------------------------------------
| 注册服务
|--------------------------------------------------------------------------
| 这里注册定义全局服务
|
*/
$app->singleton( require(ROOT_PATH.'/bootstrap/kernel.php') );


/*
|--------------------------------------------------------------------------
| 注册应用钩子
|--------------------------------------------------------------------------
| 这里搭载应用钩子
|
*/
$app->definition( require(ROOT_PATH.'/bootstrap/tags.php') );


/*
|--------------------------------------------------------------------------
| 定义应用启动模式
|--------------------------------------------------------------------------
| 这里设置应用是否为调试模式启动
|
*/
$app->debug(IS_DEBUG);


/*
|--------------------------------------------------------------------------
| 初始化应用
|--------------------------------------------------------------------------
| 这里初始化应用
|
*/
$app->init();


/*
|--------------------------------------------------------------------------
| 配置数据库
|--------------------------------------------------------------------------
| 这里配置数据库链接信息
|
*/
\mon\Db::setConfig( require(ROOT_PATH.'/bootstrap/database.php') );

/*
|--------------------------------------------------------------------------
| 定义路由
|--------------------------------------------------------------------------
| 注册应用请求路由
|
*/
$app->route->group([
    'namespace' => 'App\Http\Controller\\',
], function ($router) {
    require __DIR__.'/../app/Http/router.php';
});

return $app;